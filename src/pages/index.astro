---
import Layout from "../layouts/Layout.astro";
import { qnaList } from "./questions.js";
import "./styles.css";
import "@fontsource/poppins";
import { Image } from "astro:assets";
import roamer from "../assets/Roamer.png";

import OpenAI from "openai";

const openai = new OpenAI({
  apiKey: "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",
});

async function generateDreamVacation(userResponses) {
  try {
    const chatCompletion = await openai.chat.completions.create({
      messages: userResponses.map((response) => ({
        role: "user",
        content: response,
      })),
      model: "gpt-3.5-turbo",
    });
    const dreamVacation = chatCompletion.choices[0].message.content;
    console.log("Generated dream vacation:", dreamVacation); // Log the generated dream vacation to the console
    return dreamVacation;
  } catch (error) {
    console.error("Error generating dream vacation:", error);
    return "Sorry, an error occurred while generating your dream vacation.";
  }
}

async function handleSubmit(event) {
  event.preventDefault();
  const formData = new FormData(event.target);
  const userResponses = [];
  qnaList.forEach((qna, index) => {
    const answer = formData.get(`answer_${index}`);
    userResponses.push(answer);
  });
  const dreamVacation = await generateDreamVacation(userResponses);
  document.getElementById("result").innerText = dreamVacation; // Update the result paragraph with the dream vacation
}
---

<Layout title="Roamer">
  <Image src={roamer} alt="roamer logo" class="logo" />
  <h1>Welcome to Roamer!</h1>
  <h2>Complete the survey below to find out your next dream vacation!</h2>
  <form class="questions" onsubmit="handleSubmit">
    {
      qnaList.map((qna, questionIndex) => {
        return (
          <div>
            <p>{qna.question}</p>
            {qna.answers.map((answer, answerIndex) => {
              const inputId = `answer_${questionIndex}_${answerIndex}`;
              return (
                <div class="container">
                  <input
                    type="radio"
                    name={`answer_${questionIndex}`}
                    id={inputId}
                    value={answer}
                  />
                  <label for={inputId}>{answer}</label>
                </div>
              );
            })}
          </div>
        );
      })
    }
    <input type="submit" class="form-button" />
  </form>
  <p id="result"></p>
  {/* Paragraph element to display the generated dream vacation */}
</Layout>
